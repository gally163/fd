

---

# âœ¨ Starlight Proxy (æ˜Ÿå…‰ä»£ç†)

**â€” äºäº‘ç«¯ä¹‹å·…ï¼Œä»¥ Cloudflare Pages ç¼–ç»‡ä¸‡ç»´ä¹‹ç½‘ â€”**

<p align="center">
  <img src="https://img.shields.io/badge/Powered%20by-Cloudflare%20Pages-F38020?logo=cloudflare&logoColor=white" alt="Powered by Cloudflare Pages"/>
  <img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="License: MIT"/>
</p>

è¿™ä¸æ˜¯ä¸€æ®µå¯»å¸¸çš„ä»£ç ï¼Œè€Œæ˜¯ä¸€åº§æ¶è®¾åœ¨ Cloudflare å…¨çƒç½‘ç»œä¹‹ä¸Šçš„æ•°å­—æ¡¥æ¢ã€‚å®ƒå°†æ‚¨æœ´ç´ çš„ Cloudflare Pages ç«™ç‚¹ï¼Œå¹»åŒ–ä¸ºä¸€ä¸ªå¼ºå¤§ã€ä¼˜é›…ä¸”åŠŸèƒ½å®Œå¤‡çš„åå‘ä»£ç†ç½‘å…³ã€‚

æ‚¨çš„åŸŸåï¼Œè‡ªæ­¤æˆä¸ºä¸€æŠŠä¸‡èƒ½é’¥åŒ™ï¼Œèƒ½å¼€å¯æ•£è½åœ¨äº’è”ç½‘å„å¤„çš„å®è—ï¼Œå°†å®ƒä»¬æ— ç¼åœ°æ±‡èšäºä¸€å¤„ï¼Œå¹¶ä»¥æ‚¨ç‹¬æœ‰çš„æ–¹å¼å‘ˆç°ç»™ä¸–ç•Œã€‚æ— è®ºæ˜¯ä¸ºäº†æ•´åˆæœåŠ¡ã€éšè—æºç«™ï¼Œè¿˜æ˜¯ä¸ºäº†çªç ´é™åˆ¶ï¼Œ`Starlight Proxy` éƒ½å°†ä»¥æè‡´çš„æ€§èƒ½ä¸ç®€çº¦çš„è‰ºæœ¯ï¼Œä¸ºæ‚¨é“ºå¹³é“è·¯ã€‚

---

## æ ¸å¿ƒç‰¹æ€§ Â· The Art of Proxy

*   ğŸ¨ **å¤šç«™ç‚¹è·¯ç”± (Multi-Site Routing)**
    *   æ‚¨çš„åŸŸåå¦‚åŒä¸€åº§æ˜Ÿé™…ä¹‹é—¨ï¼Œé€šè¿‡ç®€å•çš„è·¯å¾„å‰ç¼€ï¼Œå³å¯ä¼ é€è‡³ä»»ä½•ç›®æ ‡ç½‘ç«™ã€‚æ— è®ºæ˜¯ç›®å½•è¿˜æ˜¯å…·ä½“æ–‡ä»¶ï¼Œçš†å¯ç²¾å‡†æ˜ å°„ï¼Œä¸‡åƒä¸–ç•Œï¼Œå°½åœ¨æŒæ¡ã€‚

*   ğŸª **æ— ç¼ä¼šè¯ä¿æŒ (Seamless Session Handling)**
    *   è·¨è¶ŠåŸŸåçš„é¸¿æ²Ÿï¼Œè®© Cookie å¦‚åŒå½’å·¢çš„ä¿¡é¸½ï¼Œè‡ªç”±å¾€è¿”ã€‚ç”¨æˆ·çš„æ¯ä¸€æ¬¡ç™»å½•ã€æ¯ä¸€æ¬¡ä¼šè¯ï¼Œéƒ½è¢«æ¸©æŸ”åœ°ä¿æŒï¼Œä½“éªŒå¦‚ä¸èˆ¬é¡ºæ»‘ï¼Œæ¯«æ— å‰²è£‚ä¹‹æ„Ÿã€‚

*   ğŸ”— **åŠ¨æ€å†…å®¹é‡å†™ (Dynamic Content Rewriting)**
    *   ä»£ç åŒ–èº«ä¸€ä½æŠ€è‰ºç²¾æ¹›çš„ç”»å¸ˆï¼Œåœ¨å“åº”å†…å®¹é€è¾¾æµè§ˆå™¨å‰ï¼Œæ‚„ç„¶é‡ç»˜é¡µé¢ä¸­çš„æ¯ä¸€å¤„é“¾æ¥ã€‚ç»å¯¹è·¯å¾„ã€ç›¸å¯¹è·¯å¾„ï¼Œçš†è¢«å·§å¦™åœ°è½¬æ¢ä¸ºä»£ç†åçš„åœ°å€ï¼Œç¡®ä¿æ¯ä¸€æ¬¡ç‚¹å‡»éƒ½åœç•™åœ¨æ‚¨çš„æ˜Ÿå…‰ä¹‹ä¸‹ã€‚

*   ğŸš€ **WebSocket é€æ˜ç›´é€š (Transparent WebSocket Passthrough)**
    *   ä¸ºå®æ—¶æ•°æ®æµå¼€è¾Ÿä¸€æ¡ä¸å—å¹²æ‰°çš„â€œé‡å­é€šé“â€ã€‚æ— è®ºæ˜¯å³æ—¶é€šè®¯ã€åœ¨çº¿æ¸¸æˆè¿˜æ˜¯å®æ—¶è¡Œæƒ…ï¼ŒWebSocket è¿æ¥éƒ½å°†ç•…è¡Œæ— é˜»ï¼Œä»¿ä½›ä»£ç†ä»æœªå­˜åœ¨ã€‚

*   âš™ï¸ **é…ç½®å³è‰ºæœ¯ (Configuration as Art)**
    *   æˆ‘ä»¬åšä¿¡ï¼Œè‡³ç¹å½’äºè‡³ç®€ã€‚æ‚¨åªéœ€åœ¨ `routingRules` ä¸­æç»˜æ‚¨çš„ä»£ç†è“å›¾ï¼Œå‰©ä¸‹çš„æ‰€æœ‰å¤æ‚å·¥ä½œï¼Œéƒ½ç”± `Starlight Proxy` åœ¨èƒŒåä¼˜é›…å®Œæˆã€‚

## æ¶æ„æ å½± Â· How It Shines

```graph TD
    subgraph ç”¨æˆ· (User's Browser)
        A[è®¿é—® your.pages.dev/site-A/]
        B[è®¿é—® your.pages.dev/site-B/ws]
    end

    subgraph Starlight Proxy (on Cloudflare Pages)
        C{_middleware.js}
        C -- HTTP è¯·æ±‚ --> D[é‡å†™è¯·æ±‚å¤´ & URL]
        C -- WebSocket è¯·æ±‚ --> E[å»ºç«‹ WebSocket é€šé“]
    end

    subgraph ç›®æ ‡ä¸–ç•Œ (Target Websites)
        F[Website A (example.com)]
        G[Website B (realtime-app.net)]
    end
    
    A --> C
    B --> C
    D --> F
    E --> G

    subgraph è¿”å›ä¹‹æ—… (Response Journey)
        F -- HTMLå“åº” --> H{HTMLRewriter: é‡å†™é“¾æ¥}
        G -- WebSocketæµ --> E
    end
    
    H --> A

```

## å¯ç¨‹æŒ‡å— Â· Quick Start

åªéœ€å››æ­¥ï¼Œå³å¯ç‚¹äº®æ‚¨çš„æ˜Ÿå…‰ä»£ç†ï¼š

1.  **è·å–ä»£ç **: å°†æœ¬é¡¹ç›®ä¸­çš„ `functions` ç›®å½•å®Œæ•´åœ°æ”¾å…¥æ‚¨çš„é¡¹ç›®ä»“åº“ä¸­ã€‚

2.  **åˆ›å»ºç«™ç‚¹**: ç™»å½• Cloudflare æ§åˆ¶å°ï¼Œä½¿ç”¨æ‚¨çš„ä»£ç ä»“åº“åˆ›å»ºä¸€ä¸ªæ–°çš„ Cloudflare Pages é¡¹ç›®ã€‚æ„å»ºè®¾ç½®å¯ç•™ç©ºï¼Œå› ä¸ºæˆ‘ä»¬åªä¾èµ–äº Functionsã€‚

3.  **æç»˜è“å›¾**: æ‰“å¼€ `functions/_middleware.js` æ–‡ä»¶ï¼Œåœ¨é¡¶éƒ¨çš„ `routingRules` å¯¹è±¡ä¸­ï¼Œæ·»åŠ æ‚¨çš„ä»£ç†è§„åˆ™ã€‚
    ```javascript
    // functions/_middleware.js

    const routingRules = {
      // è®¿é—® your.pages.dev/blog/ å°†ä»£ç†åˆ° https://ghost-blog.com/
      'blog': 'https://ghost-blog.com/',

      // è®¿é—® your.pages.dev/stream/ å°†ä»£ç†åˆ° https://live.example.com/player.html
      'stream': 'https://live.example.com/player.html',
      
      // ... åœ¨æ­¤æ·»åŠ æ›´å¤šå±äºæ‚¨çš„æ˜Ÿè¾°
    };
    ```

4.  **éƒ¨ç½²å¯èˆª**: æäº¤å¹¶æ¨é€æ‚¨çš„ä»£ç ã€‚Cloudflare Pages å°†è‡ªåŠ¨å®Œæˆéƒ¨ç½²ã€‚ç‰‡åˆ»ä¹‹åï¼Œè®¿é—®æ‚¨çš„ `*.pages.dev` åŸŸåï¼Œå³å¯è§è¯å¥‡è¿¹ã€‚

## è®¸å¯è¯ Â· License

é‡‡ç”¨ [MIT](LICENSE) è®¸å¯è¯ã€‚

---

<p align="center">
  <i>æ„¿æ˜Ÿå…‰ï¼Œç…§äº®æ‚¨çš„ç½‘ç»œä¹‹æ—…ã€‚</i>
</p>
